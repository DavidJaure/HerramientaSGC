<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Módulo de Capacitación</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">

<div class="max-w-6xl mx-auto">

  <h1 class="text-4xl font-bold text-center text-purple-600 mb-12"> Módulo de Capacitación</h1>

  {% if session["rol"] == "admin" %}
  <!-- Formulario de registro solo para admin -->
  <section class="bg-white rounded-2xl shadow-lg p-8 mb-10">
    <h2 class="text-2xl font-semibold mb-6 text-gray-800">Registrar Capacitación</h2>
    
    <form action="{{ url_for('capacitacion') }}" method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <div>
        <label class="block text-gray-700 font-medium mb-2">Responsable</label>
        <input type="text" name="responsable" class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 p-2">
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-2">Persona a Capacitar</label>
        <input type="text" name="persona" class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 p-2">
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-2">Documento Asignado</label>
        <select id="documento" name="documento" class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 p-2">
          <option value="">Seleccione un documento</option>
          <!-- Opciones llenadas dinámicamente -->
        </select>
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-2">Fecha</label>
        <input type="date" name="fecha" class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 p-2">
      </div>

      <div class="md:col-span-2">
        <label class="block text-gray-700 font-medium mb-2">Objetivo</label>
        <textarea name="objetivo" rows="3" class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 p-2"></textarea>
      </div>

      <div class="md:col-span-2 flex justify-center mt-4">
        <button type="submit" class="bg-purple-700 hover:bg-purple-600 text-white px-6 py-3 rounded-xl shadow-md transition font-semibold">
          Guardar Capacitación
        </button>
      </div>

    </form>
  </section>
  {% endif %}

  <!-- Buscador -->
  <section class="flex justify-end mb-4">
    <div class="relative w-full md:w-1/3">
      <input type="text" id="buscar" placeholder="🔍 Buscar por nombre" 
             class="w-full border-gray-300 rounded-lg shadow-sm p-2 pl-10 focus:ring-blue-500 focus:border-blue-500">
    </div>
  </section>

  <!-- Tabla de capacitaciones -->
  <section class="bg-white rounded-2xl shadow-lg p-8 mb-10">
    <h2 class="text-2xl font-semibold mb-6 text-gray-800">Listado de Capacitaciones</h2>
    
    <div class="overflow-x-auto">
      <table id="tabla-capacitaciones" class="w-full text-left border border-gray-200 rounded-lg">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-3 text-gray-600">Responsable</th>
            <th class="px-4 py-3 text-gray-600">Persona</th>
            <th class="px-4 py-3 text-gray-600">Documento</th>
            <th class="px-4 py-3 text-gray-600">Fecha</th>
            <th class="px-4 py-3 text-gray-600">Objetivo</th>
            {% if session["rol"] == "admin" %}
            <th class="px-4 py-3 text-gray-600">Evidencia</th>
            {% endif %}
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <!-- Filas generadas desde backend -->
          {% for cap in capacitaciones %}
            <tr>
              <td class="px-4 py-2">{{ cap.responsable }}</td>
              <td class="px-4 py-2">{{ cap.persona }}</td>
              <td class="px-4 py-2">{{ cap.documento }}</td>
              <td class="px-4 py-2">{{ cap.fecha }}</td>
              <td class="px-4 py-2">{{ cap.objetivo }}</td>
              {% if session["rol"] == "admin" %}
              <td class="px-4 py-2">
                <div class="flex items-center gap-2">
                  <button class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg text-sm transition">Subir</button>
                  {% if cap.evidencia %}
                    <span class="text-green-600 text-sm">Subido</span>
                  {% else %}
                    <span class="text-red-500 text-sm">No subido</span>
                  {% endif %}
                </div>
              </td>
              {% endif %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Botones globales según rol -->
  <div class="flex flex-wrap justify-center gap-4 mb-10">
    {% if session["rol"] == "admin" %}
      <button onclick="window.location.href='{{ url_for('implementacion') }}'" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-xl shadow-md transition font-semibold">Implementación</button>
      <button onclick="window.location.href='{{ url_for('capacitacion') }}'" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-xl shadow-md transition font-semibold">Capacitación</button>
      <button onclick="window.location.href='{{ url_for('auditoria') }}'" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-xl shadow-md transition font-semibold">Auditoría</button>
    {% elif session["rol"] == "auditor" %}
      <button onclick="window.location.href='{{ url_for('auditoria') }}'" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-xl shadow-md transition font-semibold">Auditoría</button>
    {% elif session["rol"] == "capacitado" %}
      <button onclick="window.location.href='{{ url_for('capacitacion') }}'" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-xl shadow-md transition font-semibold">Capacitación</button>
    {% endif %}
  </div>

</div>

<script>
  // Filtrado de tabla por nombre
  const inputBuscar = document.getElementById("buscar");
  const tabla = document.getElementById("tabla-capacitaciones").getElementsByTagName("tbody")[0];

  inputBuscar.addEventListener("keyup", function() {
    const filtro = inputBuscar.value.toLowerCase();
    Array.from(tabla.getElementsByTagName("tr")).forEach(row => {
      const nombre = row.cells[1].textContent.toLowerCase();
      row.style.display = nombre.includes(filtro) ? "" : "none";
    });
  });

  // Datos de plantillas completadas (llenar select solo para admin)
  {% if session["rol"] == "admin" %}
  const plantillasCompletadas = {{ plantillas_completadas|tojson }};
  const selectDocumento = document.getElementById("documento");
  plantillasCompletadas.forEach(doc => {
    const option = document.createElement("option");
    option.value = doc;
    option.textContent = doc;
    selectDocumento.appendChild(option);
  });
  {% endif %}
</script>

</body>
</html>
